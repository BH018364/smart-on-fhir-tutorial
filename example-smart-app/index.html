<!DOCTYPE html>
<html lang="en" hidden>
	<head>
	<meta http-equiv='X-UA-Compatible' content='IE=edge' />
	<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	<title>Example-SMART-App</title>

	<link rel='stylesheet' type='text/css' href='./src/css/example-smart-app.css'>
	<link rel='stylesheet' type='text/css' href='./lib/css/cerner-smart-embeddable-lib-1.0.0.min.css'>
	</head>
	<body>
		<div id="medStatementDiv">Loading meds...</div>
		<div id="allergyDiv">Loading allergies...</div>
	</body>
	<!-- Required JS files to enable this page to embed within an MPage -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js'></script>
	<script src='./lib/js/cerner-smart-embeddable-lib-1.0.0.min.js'></script>

	<!-- Application-level javascript-->
	<script src='./src/js/example-smart-app.js'></script>

	<!-- FHIR Client JS Library -->
	<script src='./lib/js/fhir-client-v0.1.12.js'></script>

	<!-- Prevent session bleed caused by single threaded embedded browser and sessionStorage API -->
	<!-- https://github.com/cerner/fhir-client-cerner-additions -->
	<script src='./lib/js/fhir-client-cerner-additions-1.0.0.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script>
	function ready(smart) {
		if (typeof smart.patient === "object") {
			var patient = smart.patient.api.fetchAll({type: 'MedicationStatement'}).then(function(response) {
				var retString = "<table>";
				response.forEach(function(medObj,idx){
					retString += "<tr><td>"+medObj.medicationCodeableConcept.text+"</td></tr>";
				});
				retString += "</table>";
				document.getElementById("medStatementDiv").innerHTML = retString;
			});
			patient.fetchAll({type:'AllergyIntolerance'}).then(function(response) {
				var retString = "<table>";
				response.entry.forEach(function(allObj,idx){
					retString += "<tr><td>"+allObj.resource.substance.text+"</td></tr>";
				});
				retString += "</table>";
				document.getElementById("allergyDiv").innerHTML = retString;
			});
		}
	}
	function notReady() {
		if (window.location.href.indexOf('error') < 0) {
			document.body.innerText = "Launch first.";
		}
	}
	FHIR.oauth2.ready(ready, notReady);
	</script>
</html>
